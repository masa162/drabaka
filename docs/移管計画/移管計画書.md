# プロジェクト移管計画書

## 1. 目的

- 現行のNext.js/Supabase/Vercel構成から、PHP/MySQL/Xserver構成へ移行する。
- 主な目的は、長期的な運用コストの削減と、安定したサービス提供インフラの確保。

## 2. 現状の課題 (As-Is)

- **技術スタック:** Next.js, TypeScript, Supabase, Vercel
- **課題:**
    - Supabase Freeプランの非アクティブ化ポリシーとプロジェクト数制限。
    - Vercel Freeプランの商用利用制限と、有償プランへの移行コスト。
    - 長期的な維持コストが不透明かつ高額になる可能性。

## 3. 移行後の構成 (To-Be)

- **技術スタック:** PHP, MySQL, (HTML/CSS/JavaScript)
- **インフラ:** Xserver (契約済み)
- **目標:**
    - 既存のサーバーリソースを有効活用。
    - 月額固定費用での安定運用を実現。

## 4. 移行タスクリスト

- **[ ] 環境構築:**
    - [x] Xserver上にPHP、MySQLの動作環境を確認。
        - **DB:** MariaDB 10.5 が利用可能。
        - **PHP:** バージョン切り替え機能有り。PHP 8.1以上を推奨。
        - **管理ツール:** phpMyAdminが利用可能。
    - [ ] 開発用のローカルPHP環境を構築 (MAMP, XAMPP, Dockerなど)。
- **[ ] データベース移行:**
    - [x] Supabase (PostgreSQL) からMySQLへのスキーマ変換。(`docs/移管計画/database_schema.sql`)
    - [ ] XserverのMySQL設定からデータベースとユーザーを作成。
    - [ ] 既存データのバックアップとMySQLへのインポート手順の確立。
- **[ ] アプリケーション再構築:**
    - [x] 現行機能の棚卸し。
    - [ ] PHPでのバックエンドロジック実装（DB接続、APIなど）。
    - [ ] フロントエンドの再構築（HTML/CSS/JS）。
- **[ ] ワークフロー見直し:**
    - [ ] Gitでのバージョン管理方針。
    - [ ] ローカルから本番環境へのデプロイ手順の確立。(XserverはSSH利用可能)
- **[ ] 競合再調査:**
    - [ ] `ch-review.net` 等のPHP製サイトの機能、UI/UXを再分析。
    - [ ] PHP/MySQL構成で実現可能な最適解を模索。

### 4.1. 機能一覧

**【ページ】**

1.  **トップページ (`/`)**
    *   放送中のドラマを曜日別に表示
    *   「今週の要注意ドラマ」を表示
    *   「話題のドラマ」を表示
    *   最新レビューを一覧表示
2.  **ドラマ詳細ページ (`/drama/[id]`)**
    *   ドラマの基本情報（タイトル、放送局、キャスト等）を表示
    *   レビューの統計情報（件数、平均評価）を表示
    *   そのドラマのレビューを一覧表示
    *   レビュー投稿フォーム
3.  **検索ページ (`/search`)**
    *   キーワード（タイトル、放送局、キャスト）でドラマを検索
    *   検索結果を一覧表示

**【API機能（データ操作）】**

1.  **ドラマ (`dramas.ts`)**
    *   全ドラマ取得
    *   ID指定でドラマ取得
    *   放送中のドラマ取得（曜日別グループ化も）
    *   完了したドラマ取得
    *   ドラマ検索
    *   特集ドラマ取得（要注意、話題）
2.  **レビュー (`reviews.ts`)**
    *   ドラマIDに紐づくレビューを取得
    *   最新レビューを取得
    *   レビューを投稿
    *   ドラマのレビュー統計（件数、平均点）を取得
3.  **いいね (`likes.ts`)**
    *   レビューのいいね数を取得
    *   ユーザーがいいね済みかチェック
    *   いいねの追加・削除（トグル）
    *   複数レビューのいいね情報を一括取得

## 5. スケジュール（案）

- **8/6:** 計画策定、環境調査
- **8/7 - 8/15:** データベース移行、基本機能の実装
- **8/16 -:** ...